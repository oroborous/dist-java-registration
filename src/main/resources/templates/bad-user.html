<html xmlns:th="http://thymeleaf.org">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <title>Bad User</title>
</head>
<body>
<div class="container">
    <h1 class="alert alert-danger" th:text="${param.messageKey}">error</h1>
    <br/>
    <a class="btn btn-default" th:href="@{/v/register}">Register</a>

    <div th:if="${param.expired}">
        <br/>
        <h1>Resend Verification Email</h1>
        <button onclick="resendToken()">Resend</button>

        <script th:inline="javascript">
            var serverContext = /*[[@{/}]]*/ "/";

                function resendToken() {
                    var token = /*[[${param.token}]]*/ "none";
                    $.get(serverContext + "r/resendToken?token=" + token, function (data) {
                        window.location.href = serverContext + "v/login?messageKey=" + data.message;
                    })
                    .fail(function (data) {
                        if (data.responseJSON.error.includes("MailError")) {
                            window.location.href = serverContext + "v/emailError";
                        } else {
                            window.location.href = serverContext + "v/login?messageKey=" + data.responseJSON.message;
                        }
                    });
                }

                $(document).ajaxStart(function () {
                    $("title").html("LOADING ...");
                });
        </script>

    </div>
</div>
</body>
</html>
